# Deployment Guide - Render

This guide will help you deploy the Movie Recommendation App to Render.

## Prerequisites

- A [Render account](https://render.com/)
- Your code pushed to a GitHub repository
- TMDb API key (get it from [TMDb](https://www.themoviedb.org/settings/api))

## Deployment Steps

### Option 1: Using render.yaml (Recommended)

This is the easiest way to deploy. The `render.yaml` file is already configured with all necessary services.

1. **Push your code to GitHub**
   ```bash
   git add .
   git commit -m "Prepare for Render deployment"
   git push origin main
   ```

2. **Connect to Render**
   - Go to [Render Dashboard](https://dashboard.render.com/)
   - Click "New" → "Blueprint"
   - Connect your GitHub repository
   - Select the repository containing this project
   - Render will automatically detect `render.yaml` and create all services

3. **Configure Environment Variables**

   After the services are created, go to the web service settings and add these environment variables:

   **Required:**
   - `SECRET_KEY` - Django secret key (auto-generated by Render)
   - `DEBUG` - Set to `false` (already set in render.yaml)
   - `ALLOWED_HOSTS` - Your Render domain (e.g., `your-app.onrender.com`)
   - `TMDB_API_KEY` - Your TMDb API key
   - `DATABASE_URL` - Auto-configured from database service
   - `REDIS_URL` - Auto-configured from Redis service

   **Optional:**
   - `CORS_ALLOWED_ORIGINS` - Frontend URLs (comma-separated)
   - `JWT_ACCESS_TOKEN_LIFETIME` - Access token lifetime in minutes (default: 60)
   - `JWT_REFRESH_TOKEN_LIFETIME` - Refresh token lifetime in minutes (default: 1440)

4. **Deploy**
   - Render will automatically deploy your application
   - Wait for the build to complete (this may take 5-10 minutes)
   - Your app will be available at `https://your-app.onrender.com`

### Option 2: Manual Setup

If you prefer to set up services manually:

1. **Create PostgreSQL Database**
   - Go to Render Dashboard
   - Click "New" → "PostgreSQL"
   - Name: `movie-recommendation-db`
   - Database: `movie_recommendation_db`
   - User: `movie_rec_user`
   - Plan: Choose your plan (Free tier available)
   - Click "Create Database"
   - Copy the "Internal Database URL" for later

2. **Create Redis Instance**
   - Click "New" → "Redis"
   - Name: `movie-recommendation-redis`
   - Plan: Starter (or Free if available)
   - Click "Create Redis"
   - Copy the "Internal Redis URL" for later

3. **Create Web Service**
   - Click "New" → "Web Service"
   - Connect your GitHub repository
   - Configure:
     - **Name:** `movie-recommendation-api`
     - **Runtime:** Python 3
     - **Build Command:** `./build.sh`
     - **Start Command:** `gunicorn movie_recomendation.wsgi:application`
     - **Plan:** Choose your plan (Free tier available)

4. **Add Environment Variables** (same as Option 1)

5. **Deploy**

## Post-Deployment

### Create Superuser

After deployment, you'll need to create a superuser:

1. Go to your web service on Render
2. Click "Shell" in the left sidebar
3. Run:
   ```bash
   python manage.py createsuperuser
   ```
4. Follow the prompts to create your admin account

### Access Admin Panel

- Admin panel: `https://your-app.onrender.com/admin/`
- API documentation: `https://your-app.onrender.com/swagger/`

### Test the Deployment

1. Visit `https://your-app.onrender.com/` - You should see the API welcome message
2. Visit `https://your-app.onrender.com/swagger/` - API documentation should load
3. Try creating an account via the API
4. Test the movie endpoints

## Environment Variables Reference

| Variable | Required | Default | Description |
|----------|----------|---------|-------------|
| `SECRET_KEY` | Yes | - | Django secret key |
| `DEBUG` | No | `false` | Debug mode (always false in production) |
| `ALLOWED_HOSTS` | Yes | - | Comma-separated list of allowed hosts |
| `DATABASE_URL` | Yes | - | PostgreSQL connection string |
| `REDIS_URL` | No | - | Redis connection string |
| `TMDB_API_KEY` | Yes | - | TMDb API key for movie data |
| `TMDB_BASE_URL` | No | `https://api.themoviedb.org/3` | TMDb API base URL |
| `CORS_ALLOWED_ORIGINS` | No | - | Comma-separated frontend URLs |
| `JWT_ACCESS_TOKEN_LIFETIME` | No | `60` | Access token lifetime (minutes) |
| `JWT_REFRESH_TOKEN_LIFETIME` | No | `1440` | Refresh token lifetime (minutes) |

## Monitoring

- **Logs:** Available in Render dashboard under your web service
- **Metrics:** Render provides basic metrics (CPU, memory, requests)
- **Errors:** Check logs for any runtime errors

## Updating the Deployment

To deploy updates:

1. Push changes to your GitHub repository:
   ```bash
   git add .
   git commit -m "Your update message"
   git push origin main
   ```

2. Render will automatically detect the changes and redeploy

Or manually trigger a deploy from the Render dashboard.

## Troubleshooting

### Build Fails

- Check the build logs in Render dashboard
- Ensure all dependencies are in `requirements.txt`
- Verify `build.sh` has execution permissions

### Database Connection Issues

- Verify `DATABASE_URL` is set correctly
- Check database is running and accessible
- Review database logs in Render

### Static Files Not Loading

- Ensure `whitenoise` is installed
- Verify `STATIC_ROOT` is configured
- Check that collectstatic ran during build

### Redis Connection Issues

- If Redis is optional, the app will use dummy cache
- Verify `REDIS_URL` is set if using Redis
- Check Redis instance is running

## Free Tier Limitations

Render's free tier has some limitations:

- **Web Services:** Spin down after 15 minutes of inactivity (cold starts)
- **PostgreSQL:** 90 days expiration, 1 GB storage
- **Redis:** Limited memory and connections

For production use, consider upgrading to a paid plan.

## Security Checklist

- [ ] `DEBUG` is set to `false`
- [ ] `SECRET_KEY` is unique and secure (auto-generated)
- [ ] `ALLOWED_HOSTS` is configured correctly
- [ ] Database credentials are secure
- [ ] HTTPS is enabled (automatic on Render)
- [ ] CORS is configured for your frontend
- [ ] Rate limiting is enabled (already configured)

## Support

- [Render Documentation](https://render.com/docs)
- [Django Deployment Checklist](https://docs.djangoproject.com/en/stable/howto/deployment/checklist/)
- Project issues: Check the GitHub repository
